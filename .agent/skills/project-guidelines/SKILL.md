---
name: project-guidelines
description: Core architecture guidelines, coding standards, and data pipeline protocols for the Welfare Master project.
---

# Welfare Master Project - Golden Rules

**Strictly adhere to these rules to ensure the success of the "One Codebase, Multi Apps" strategy.**

## 1. Core Principles (The Iron Triangle)
1.  **Single Source of Truth**: `master_database.json` generated by the Python pipeline is the absolute truth. The App must strictly validate this data using Zod/Pydantic schemas.
2.  **Type Safety First**:
    *   **TypeScript**: `any` is strictly BANNED. Use `unknown` + Zod validation.
    *   **Python**: Type hints are mandatory. Use Pydantic for data models.
3.  **Strict Isolation**: The App Code (`/app`) must NEVER depend on the internal logic of the Data Pipeline (`/data_pipeline`). They communicate ONLY via the JSON contract.

## 2. TypeScript / React Native Guidelines
*Reference: Derived from Senior TypeScript Architect Standards*

### Architecture & patterns
*   **Functional Components**: Use React Functional Components (FC) and Hooks. Class components are prohibited.
*   **Styling**: Use **NativeWind** (Tailwind CSS) for all styling.
    *   ✅ `<View className="bg-white p-4" />`
    *   ⛔ `StyleSheet.create(...)` (Use only for complex animations or unavoidable native tweaks).
    *   ⚠️ **Native Components (e.g. LinearGradient)**: NativeWind's `className` can fail for `borderRadius`, `padding`, and `overflow` on these. Use the `style` prop directly for such layout properties to ensure visual fidelity.
    *   ⚠️ **Unsupported Styles**: `blur-*` (e.g., `blur-3xl`) is NOT supported in standard React Native and will cause rendering artifacts (black boxes). 
*   **Safe Areas**: All screens must implement `SafeAreaView` from `react-native-safe-area-context`.

### Coding Standards
*   **Zod for Data**: All external data (JSON imports) MUST be validated with Zod schemas at the point of entry.
*   **No Throwing**: Do not throw errors in UI logic. Handle states (`loading`, `error`, `success`) explicitly.
*   **Expo First**: Use Expo SDK libraries (FileSystem, SQLite, etc.) over bare React Native libraries whenever possible.

## 3. Python Data Pipeline Guidelines
*Reference: Derived from AI-Native Python Standards*

### Infrastructure
*   **Pydantic**: Use Pydantic models for all structured data (Input Raw Data -> Output Master JSON).
*   **Linting**: Follow `ruff` standards (PEP 8 compliant, optimized imports).
*   **Typing**: `mypy --strict` compliance is expected.

### Process Flow
1.  **Extract**: Read `raw_questions.json` (exported from SQLite).
2.  **Transform**: Use Gemini API (via `google-generativeai`) to rewrite explanations/questions.
    *   *Retry Logic*: Network calls must have exponential backoff/retries.
3.  **Load**: validated JSON to `master_database.json`.

## 4. Multi-Flavor Strategy
*   **Configuration**: All app variations (Social, Mental, Care) must be controlled via `app.config.ts` and environment variables.
*   **No Magic Strings**: Use constants or enums for `group_filter` (e.g., `GROUP.PAST_SOCIAL`).

## 5. Environment & Troubleshooting
*   **Expo SDK & Native Modules**: Always match JavaScript versions to the native versions bundled with the user's Expo Go. 
    *   *Worklets Mismatch*: If `Mismatch between JS part and native part of Worklets` occurs, verify and force-match the version in `package.json` to exactly what the mobile Go app provides.
*   **Babel & Metro**: `metro.config.js` MUST be correctly configured for NativeWind to scan files.
*   **Development Toggles**: Use a global `SHOW_ONBOARDING_FLOW` constant in `_layout.tsx` to bypass repetitive UX flows.

## 6. Workflow Protocols
1.  **Data Change**: If schema changes in Python, immediately update the Zod schema in TypeScript.
2.  **Commit Messages**: Use semantic commits (feat, fix, docs, style, refactor).
