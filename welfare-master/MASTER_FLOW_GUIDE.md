# 資格試験アプリ量産化フレームワーク "Master Flow" (CTO Edition)

このドキュメントは、本プロジェクトで得られた教訓に基づき、他の資格試験（宅建、行政書士、介護福祉士等）へ汎用展開するための「標準ワークフロー」および「高度な戦略」を定義したものです。

## 1. 開発の三原則
1.  **環境構築は「臆病」に**: Expo SDKとの互換性を最優先し、ライブラリ追加は慎重に行う。
2.  **データは「精錬」せよ**: 生データをAIで「血の通った解説」に変換し、独自価値を最大化する。
3.  **アプリは「フレーバー」で管理**: 同一コード、別設定（色、ロゴ、DB、独自機能）で多展開する。

---

## 2. 標準開発プロセス (Phase 1 - 4)

### Phase 1: データ・リファイナリー（データ精錬）
1.  **Normalization**: 年度、カテゴリ、複数解答形式を統一JSONに変換。
2.  **AI Refining**: 
    *   **Audit (監査役AI)**: 生成された解説が正解の結論と矛盾していないか、別のAIにダブルチェックさせる。
3.  **Human-in-the-loop**: 重要な法律箇所は人間が確認する、または「ユーザー報告機能」を設置しインセンティブ（PRO版開放等）でデバッグを加速。

### Phase 2: コア・エンジン構築（共通UI & 高速化）
1.  **Pre-filled DB Strategy**: 初回起動時のインポート待ちを避けるため、ビルド時にSQLiteの `.db` ファイルを生成・assets同梱し、起動時はコピーのみで0.1秒起動を実現する。
2.  **Haptic & Animation**: `expo-haptics` 等を用いた触覚フィードバックを全フレーバーに標準装備。
3.  **Config Plugins**: 将来的には Expo Config Plugins を活用し、資格ごとに AndroidManifest や Info.plist (ネイティブ設定) を出し分けられるようにする。

### Phase 3: フレーバー展開と審査対策
1.  **Apple Spam (4.3) 対策**: 
    *   **UI差別化**: トップ画面の構成を資格ごとに変更（例：宅建は街、福祉は人物イラスト等）。
    *   **独自機能の注入**: 特定の資格にしかない「計算シミュレーター」や「暗記カード」をプラスαで実装し、別物であることを主張する。
2.  **Metadata Branding**: ストア説明文に資格特有のキーワード（「民法改正対応」等）を盛り込み、独自性を強調。

### Phase 4: ストア申請・マネタイズ
1.  **RevenueCat Integration**: 課金による「年度別アンロック」の標準化。
2.  **Automation**: スクリーンショット作成の各フレーバー一括自動化。

---

## 3. Windows環境の「除霊」と保守
Windows環境の残留キャッシュやプロセスによる不整合を防ぐため、`package.json` に標準コマンドとして登録。

```json
"scripts": {
  "exorcise": "taskkill /IM node.exe /F || echo 'No process' && rmdir /s /q node_modules .expo && npm cache clean --force && npm install && npx expo start --clear"
}
```
※ `rimraf` などのクロスプラットフォーム対応ライブラリの使用を推奨。

### [緊急] データ更新時の「最強キャッシュバスター」
Expo Metro Bundlerは、`require('../assets/data.json')` のコンテンツを強力にキャッシュし、ファイルの中身だけを変えても反映されないことがある（特にWindows）。

**解決策:**
1.  **ファイル名変更**: `data.json` → `data_v2.json` というように物理的なファイル名を変更する。これが最も確実。
2.  **DBバージョンアップ**: SQLiteのDB名も `master_v1.db` → `master_v2.db` と変更し、強制的に初期化させる。
3.  **古いファイルの退避**: `data.json` が残っていると、優先順位の関係でそちらが読まれる事故を防ぐため、必ず `__ARCHIVE__` 等へリネームまたは削除する。

---

## 4. 継承される資産：Master Flow
「UI/UXの開発コストは1回分」で、「データ作成はAIで自動化・監査」。
このフローを回すことで、新しい資格試験の要望に対し、**「数週間でのスピードリリース」**と**「エラーのない堅牢な品質」**を両立させ、学習市場での圧倒的優位性を確立する。
